{% load wagtailimages_tags %}

{% for article in related_articles %}
<article class="related-article-card fade-in-up" style="background: white; border-radius: var(--radius-xl); overflow: hidden; box-shadow: var(--shadow); transition: all var(--transition-normal); height: 100%; display: flex; flex-direction: column;">
    {% if article.featured_image %}
    <div class="related-article-image" style="aspect-ratio: 16/9; overflow: hidden;">
        <a href="{{ article.get_url }}">
            <picture>
                {% image article.featured_image width-400 format-avif as img_avif %}
                {% image article.featured_image width-400 format-webp as img_webp %}
                {% image article.featured_image width-400 as img_fallback %}
                
                <source srcset="{{ img_avif.url }}" type="image/avif">
                <source srcset="{{ img_webp.url }}" type="image/webp">
                <img src="{{ img_fallback.url }}" 
                     alt="{{ article.featured_image.title|default:article.title }}"
                     loading="lazy"
                     style="width: 100%; height: 100%; object-fit: cover; transition: transform var(--transition-slow);">
            </picture>
        </a>
    </div>
    {% endif %}
    
    <div class="related-article-content" style="padding: 1.5rem; flex: 1; display: flex; flex-direction: column;">
        <div class="related-article-meta" style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; font-size: var(--font-size-xs); color: var(--color-gray-500);">
            {% if article.category %}
            <span class="category-badge" 
                  style="background: {{ article.category.color|default:'var(--color-primary)' }}; color: white; padding: 0.125rem 0.5rem; border-radius: var(--radius); font-weight: 500;">
                {{ article.category.name }}
            </span>
            {% endif %}
            <time>{{ article.first_published_at|date:"M d" }}</time>
            {% if article.reading_time_minutes %}
            <span>{{ article.reading_time_minutes }} min</span>
            {% endif %}
        </div>
        
        <h3 class="related-article-title" style="font-family: var(--font-display); font-size: var(--font-size-lg); font-weight: 600; line-height: var(--leading-tight); margin-bottom: 0.75rem; flex: 1;">
            <a href="{{ article.get_url }}" style="text-decoration: none; color: var(--color-gray-900); transition: color var(--transition-fast);">
                {{ article.title }}
            </a>
        </h3>
        
        {% if article.intro %}
        <p class="related-article-excerpt" style="color: var(--color-gray-600); font-size: var(--font-size-sm); line-height: var(--leading-relaxed); margin-bottom: 1rem;">
            {{ article.intro|truncatewords:15 }}
        </p>
        {% endif %}
        
        <div class="related-article-footer" style="display: flex; align-items: center; justify-content: space-between; font-size: var(--font-size-xs); color: var(--color-gray-500);">
            <div class="article-stats" style="display: flex; align-items: center; gap: 0.75rem;">
                {% if article.view_count %}
                <span style="display: flex; align-items: center; gap: 0.25rem;">
                    <svg style="width: 14px; height: 14px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    {{ article.view_count }}
                </span>
                {% endif %}
            </div>
            
            <a href="{{ article.get_url }}" class="read-more" style="color: var(--color-primary); text-decoration: none; font-weight: 500; transition: color var(--transition-fast);">
                Read â†’
            </a>
        </div>
    </div>
</article>
{% empty %}
<div class="no-related" style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--color-gray-500);">
    <p>No related articles found.</p>
</div>
{% endfor %}

<style>
.related-article-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
}

.related-article-card:hover img {
    transform: scale(1.05);
}

.related-article-title a:hover {
    color: var(--color-primary);
}

.read-more:hover {
    color: var(--color-primary-dark);
}
</style>